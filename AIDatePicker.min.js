!function(){function a(){}function b(b){var f=this;if(this._ruls=b.rules,this.valLength=2,b.valLength&&(this.valLength=b.valLength),this._curVal=[],b.val instanceof Date)this._curVal.push(n(start,"YYYYMMDD"));else if(b.val instanceof Array&&b.val[0])for(var g in b.val)this._curVal.push(n(b.val[g],"YYYYMMDD"));this._item=3,$("#"+q).on("touchmove",function(a){a.preventDefault()}).on("click",".J_time_hook",function(){var b=f._curVal,e=new a;if(!$(this).hasClass("disabled")&&!$(this).hasClass("noin")){var g=$(this).hasClass("selected"),h=$(this).data("val")+"",i=b.slice(0);if(g){var j=d(i,h);i.splice(j,1);var k=e.trigger({name:"unSelect",val:o(h,"YYYYMMDD"),otherVal:c(i)});if(0!=k){$(this).removeClass("selected");var j=d(b,h);b.splice(j,1)}}else{if(b.length>=f.valLength)return;var k=e.trigger({name:"select",val:o(h,"YYYYMMDD"),otherVal:c(i)});0!=k&&($(this).addClass("selected"),-1==d(b,h)&&b.push(h),f.valLength==b.length&&(b.sort(),f.hide()))}}}),new e($("#"+r),this)}function c(a){var b=[];for(var c in a){var d=b.length;for(var e in b)if(n(b[e],"YYYYMMDD")>a[c]){d=e;break}b.splice(d,0,o(a[c]+"","YYYYMMDD"))}return b}function d(a,b){for(var c in a)if(a[c]==b)return c;return-1}function e(a,b){var c=0,d=0,e=0,n=$(a).children(),o=n?n[0]:void 0,p=!1;$(o).css("-webkit-transform","translate3d(0,0,0)").on("touchstart",function(a){e=(new Date).getTime(),p&&$(this).css("-webkit-transition","none"),c=f(this),d=a.originalEvent.touches[0].clientY}).on("touchmove",function(a){var b=a.originalEvent.touches[0].clientY,e=c+(b-d);$(this).css("-webkit-transform","translate3d(0, "+e+"px, 0)")}).on("touchend",function(f){var n=f.originalEvent.changedTouches[0].clientY,q=c+(n-d);if(g(a,q)&&!k(b)){var r=i(b,q);q=j(this,r,q)}h(a,this,q)&&!m(b)&&l(b,this);var s=((new Date).getTime()-e)/1e3,t=0,u=.2;if(.2>=s){.09>s&&(s=.09);var v=Math.abs(n-d),w=4e3,x=v/s,u=x/w,t=w*Math.pow(u,2)}0>n-d&&(t=-1*t);for(var y=q+t;g(a,y)&&!k(b);){var r=i(b,q);q=j(this,r,q),y=q+t}for(;h(a,this,y)&&!m(b);)l(b,this);var z=$(a).height(),A=$(o).height();y>0?y=0:z>y+A&&(y=-1*(A-z));var B=$(this);B.css("-webkit-transition","-webkit-transform "+u+"s cubic-bezier(.35,.88,.42,1)").css("-webkit-transform","translate3d(0,"+y+"px, 0)"),p=!0,setTimeout(function(){B.css("-webkit-transition","none"),p=!1},1e3*u)})}function f(a){var b=$(a).css("-webkit-transform");if(b&&b.match(/\(.*\)/)){var c=b.match(/\(.*\)/)[0].split(","),d=c.length>=5?5:1;return parseInt(c[d])}return 0}function g(a,b){var c=$(a).height();return b>.8*c*-1?!0:!1}function h(a,b,c){var d=$(a).height(),e=$(b).height();return 1.8*d>c+e?!0:!1}function i(a){a._curMin.setMonth(a._curMin.getMonth()-a._item+1);for(var b="",c=0;c<a._item;c++)b+=a.createMonth(a._curMin),a._curMin.setMonth(a._curMin.getMonth()+1);return a._curMin.setMonth(a._curMin.getMonth()-a._item-1),b}function j(a,b,c){var d=$(a),e=d.height();d.prepend(b);var f=d.height();return c-=f-e,d.css("-webkit-transform","translate3d(0,"+c+"px, 0)"),c}function k(a){for(var b in a._ruls){var c=a._ruls[b];if("object"==typeof c&&"min"==c.name&&n(c.val,"YYYYMM")>n(a._curMin,"YYYYMM"))return!0}return!1}function l(a,b){for(var c="",d=0;d<a._item;d++)c+=a.createMonth(a._curMax),a._curMax.setMonth(a._curMax.getMonth()+1);$(b).append(c)}function m(a){for(var b in a._ruls){var c=a._ruls[b];if("object"==typeof c&&"max"==c.name&&n(c.val,"YYYYMM")<n(a._curMax,"YYYYMM"))return!0}return!1}function n(a,b){var c=b;return a?(c=c.replace(/yyyy|YYYY/,a.getFullYear()),c=c.replace(/yy|YY/,a.getYear()%100>9?(a.getYear()%100).toString():"0"+a.getYear()%100),c=c.replace(/MM/,a.getMonth()>8?(a.getMonth()+1).toString():"0"+(a.getMonth()+1)),c=c.replace(/M/g,a.getMonth()+1),c=c.replace(/dd|DD/,a.getDate()>9?a.getDate().toString():"0"+a.getDate()),c=c.replace(/d|D/g,a.getDate()),c=c.replace(/hh|HH/,a.getHours()>9?a.getHours().toString():"0"+a.getHours()),c=c.replace(/h|H/g,a.getHours()),c=c.replace(/mm/,a.getMinutes()>9?a.getMinutes().toString():"0"+a.getMinutes()),c=c.replace(/m/g,a.getMinutes()),c=c.replace(/ss|SS/,a.getSeconds()>9?a.getSeconds().toString():"0"+a.getSeconds()),c=c.replace(/s|S/g,a.getSeconds())):c="",c}function o(a,b){function c(a,b,c){var e=c.length,f=b.indexOf(c);if(0>f)return f;var g=a.substr(f-d,e),h=parseInt(g,10);return 10>h&&0!=g.charAt(0)&&d++,h}if(!a)return null;var d=0,e=new Date,f=b.toUpperCase(),g=c(a,f,"YYYY"),h=c(a,f,"MM"),i=c(a,f,"DD"),j=c(a,f,"HH"),k=c(a,f,"MN"),l=c(a,f,"SS");return g>0&&e.setFullYear(g),h>0&&e.setMonth(h-1),i>0&&e.setDate(i),j>0&&e.setHours(j),k>0&&e.setMinutes(k),l>0&&e.setSeconds(l),e}var p=(new Date).getTime(),q="J_datepicker_"+p,r="J_datepicker_monthblock_wrap_"+p,s="J_datepicker_monthblock_"+p,t='<div id="'+q+'" class="nb-time fn-hide"><table class="nb-table nb-table-time nb-table-time-title"><tr><td colspan="7" class="nb-table-time-head"><span class="nb-head-title" style="font-size:1.24em">选择日期</span></td></tr><tr><td>日</td><td>一</td><td>二</td><td>三</td><td>四</td><td>五</td><td>六</td></tr></table><div id="'+r+'" class="nb-time-monthblock-wrap"><div id="'+s+'"></div></div></div>';$("body").append(t);var u={};a.prototype.addListener=function(a,b){u[a]||(u[a]=[]),u[a].push(b)},a.prototype.trigger=function(a){"string"==typeof a&&(a={name:a});var b=u[a.name];if(b)for(var c=0;c<b.length;c++)return b[c](a)},a.prototype.removeListener=function(a){delete u[a]},b.prototype.on=function(b,c){var d=new a;return d.addListener(b,c),this},b.prototype.createMonth=function(a){var b='<div class="nb-time-month">'+n(a,"YYYY年MM月")+"</div>",c=new Date(a.getTime());c.setDate(1);var d=c.getUTCDay();0!=d&&c.setDate(-1*d+1);for(var e='<table class="nb-table nb-table-time nb-table-time-date"><tr>',f=1;35>=f;f++){var g=c.getDate(),h="";a.getMonth()!=c.getMonth()&&(h="noin");var i=g;if(n(new Date,"YYYYMMDD")==n(c,"YYYYMMDD"))var i=g+'<p class="desc">今天</p>';var j="";if(this._ruls)for(var k in this._ruls){var l=!0,m=this._ruls[k];"function"==typeof m?l=m(c):"object"==typeof m&&(l=v[m.name](c,m.val)),l||(j="disabled")}var o="";if(this._curVal)for(var p in this._curVal)if(this._curVal[p]==n(c,"YYYYMMDD")&&!h){o="selected";break}e+='<td class="J_time_hook '+h+" "+j+" "+o+'" data-val='+n(c,"YYYYMMDD")+">"+i+"</td>",f%7==0&&(e+="</tr><tr>"),c.setDate(g+1)}return e+="</table>",b+e},b.prototype.hide=function(){var b=$(window).height();return $("#"+q).css("-webkit-transform","translate3d(0,"+b+"px, 0)"),setTimeout(function(){$("#"+q).addClass("fn-hide")},300),(new a).trigger({name:"hide",val:c(this._curVal)}),this},b.prototype.show=function(){var a=new Date;this._curVal[0]&&(a=o(this._curVal[0],"YYYYMMDD")),a.setMonth(a.getMonth()-3),this._curMin=new Date(a.getTime()),this._curMin.setMonth(this._curMin.getMonth()-1);for(var b="",c=0;7>c;c++)b+=this.createMonth(a),a.setMonth(a.getMonth()+1);this._curMax=new Date(a.getTime()),$("#"+s).html(b);var d=$(window).height();$("#"+r).css("height",d-100);var e=document.body.scrollTop;return $("#"+q).removeClass("fn-hide").css({top:e,height:d+"px","-webkit-transform":"translate3d(0,"+d+"px, 0)"}),setTimeout(function(){$("#"+q).css("-webkit-transform","none")},0),$("#"+s).css("-webkit-transform","translate3d(0,-40%, 0)"),this};var v={max:function(a,b){return n(b,"YYYYMMDD")>=n(a,"YYYYMMDD")?!0:!1},min:function(a,b){return n(b,"YYYYMMDD")<=n(a,"YYYYMMDD")?!0:!1}};window.NBDatePicker=b}();